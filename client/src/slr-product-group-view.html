<link rel="import" href="../bower_components/polymer/polymer-element.html">

<link rel="import" href="./slr-dialog.html">

<dom-module id="slr-product-group-view">
  <template>
    <style include="common-styles">
      :host {
        display: block;
        @apply --slr-content;
        text-align: left;
      }

      paper-dialog {
        max-width: var(--app-content-max-width);
        min-width: 500px;
      }
    </style>

    <slr-dialog title="Product Group"
                    item={{item}}
                    opened={{opened}}
                    edit-mode={{editMode}}
                    loading={{loading}}>
      <div slot="actions" hidden$="{{!editMode}}">
        <paper-button id="action"
                      hidden$="{{loading}}"
                      on-click="submit"
                      autofocus>Save</paper-button>
      </div>

      <iron-form id="form">
        <form class="form" method="post" action="/api/product-groups">
          <paper-input  name="name"
                        type="text"
                        label="Name" always-float-label
                        disabled={{!editMode}}
                        value="{{item.name}}"
                        required></paper-input>
          <paper-input  name="department"
                        type="text"
                        label="Department" always-float-label
                        disabled={{!editMode}}
                        value="{{item.department}}"
                        required></paper-input>
        </form>
      </iron-form>
    </slr-dialog>
  </template>
  <script>
    class SlrProductGroupView extends Polymer.Element {
      static get is() { return 'slr-product-group-view' }

      static get properties() {
        return {
          item: {
            type: Object
          },
          opened: {
            type: Boolean,
            value: false,
            notify: true
          },
          loading: {
            type: Boolean,
            notify: true
          },
          editMode: {
            type: Boolean,
            value: false,
            notify: true
          }
        }
      }

      ready() {
        super.ready()

        this.$.form
          .addEventListener('iron-form-presubmit', () => {
            this.set('loading', true)
            console.log('Form submitted:', this.$.form.serializeForm())
          })

        this.$.form
          .addEventListener('iron-form-error', (e) => {
            console.error('Error:', e)
            // notify of error
          })

        this.$.form
          .addEventListener('iron-form-response', (e) => {
            this.set('opened', false)
            this.dispatchEvent(new CustomEvent('slr-product-group-added'))
            this.dispatchEvent(new CustomEvent('slr-notify',
              {
                detail: 'Product Group added.',
                bubbles: true,
                composed: true
              })
            )
          })
      }

      submit() {
        if (!this.$.form.validate()) {
          return
        }
        this.$.form.submit()
      }
    }

    window.customElements.define(SlrProductGroupView.is, SlrProductGroupView)
  </script>
</dom-module>
